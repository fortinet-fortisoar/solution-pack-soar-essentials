{
  "type": "workflow_collections",
  "data": [
    {
      "@context": "/api/3/contexts/WorkflowCollection",
      "@type": "WorkflowCollection",
      "name": "06 - IRP - Reporting",
      "description": null,
      "visible": true,
      "image": null,
      "uuid": "08c36467-9130-45a6-b4e7-391b8d87da7b",
      "id": 19,
      "createDate": 1649320375.517511,
      "modifyDate": 1649320375.517511,
      "deletedAt": null,
      "importedBy": [
        {
          "apiName": "sOARFramework",
          "name": "SOAR Framework",
          "version": "1.0.0"
        }
      ],
      "recordTags": [],
      "workflows": [
        {
          "@type": "Workflow",
          "triggerLimit": null,
          "name": "Get Paginated Records",
          "aliasName": null,
          "tag": null,
          "description": "Gets paginated records data and appends them in a .CSV file. This playbook is a reference playbook for 'Export as CSV'.",
          "isActive": true,
          "debug": false,
          "singleRecordExecution": false,
          "remoteExecutableFlag": false,
          "parameters": [
            "queryURL",
            "fileToUpdate",
            "queryBody",
            "datetimeFieldsToConvert",
            "timezone"
          ],
          "synchronous": false,
          "lastModifyDate": 1649320376,
          "collection": "/api/3/workflow_collections/08c36467-9130-45a6-b4e7-391b8d87da7b",
          "versions": [],
          "triggerStep": "/api/3/workflow_steps/bd320f7b-58f9-407b-844e-59420c58dc3f",
          "steps": [
            {
              "@type": "WorkflowStep",
              "name": "Run Query",
              "description": null,
              "arguments": {
                "params": {
                  "iri": "{{vars.input.params.queryURL}}",
                  "body": "{{vars.input.params.queryBody}}",
                  "method": "POST"
                },
                "version": "2.7.0",
                "connector": "cyops_utilities",
                "operation": "make_cyops_request",
                "operationTitle": "CyOPs: Make CyOPs API Call",
                "step_variables": []
              },
              "status": null,
              "top": "165",
              "left": "125",
              "stepType": "/api/3/workflow_step_types/0109f35d-090b-4a2b-bd8a-94cbc3508562",
              "uuid": "6244a24c-db42-4e1e-8d0a-ac349750f161"
            },
            {
              "@type": "WorkflowStep",
              "name": "Append to CSV File",
              "description": null,
              "arguments": {
                "config": "0fd89191-0436-4ba1-8eca-88771f17e159",
                "params": {
                  "python_function": "import csv\nimport arrow\n\nrecordsToSave = {{vars.steps.Run_Query.data['hydra:member']}}\ntimezone = \"{{vars.input.params.timezone}}\"\ncolumns = recordsToSave[0].keys()\nwith open('{{vars.fileToUpdate}}','a') as out_file:\n    csv_w = csv.writer(out_file)\n    for record in recordsToSave:\n        values = []\n        for key in columns:\n            if type(record[key]) is dict:\n               recordType = (record[key]).get('@type', None)\n               if recordType == 'Picklist':\n                   values.append(str(record[key]['itemValue']))\n               elif recordType == 'Person':\n                   values.append(str(record[key]['firstname'] + record[key]['lastname']))\n               elif recordType == 'Appliance':\n                   values.append(str(record[key]['name']))\n            elif key in {{ vars.input.params.datetimeFieldsToConvert}}:\n                values.append(arrow.get(record[key]).to(timezone).format('YYYY-MM-DD HH:mm:ss ZZ'))\n            elif key in {{ vars.input.params.queryBody['__selectFields']}}:\n                values.append(str(record[key]))\n        csv_w.writerow(values)"
                },
                "version": "1.2.5",
                "connector": "code-snippet",
                "operation": "python_inline",
                "operationTitle": "Execute Python Code",
                "step_variables": []
              },
              "status": null,
              "top": "300",
              "left": "125",
              "stepType": "/api/3/workflow_step_types/1fdd14cc-d6b4-4335-a3af-ab49c8ed2fd8",
              "uuid": "725387d7-8917-4ce6-b2a7-5d8884655aac"
            },
            {
              "@type": "WorkflowStep",
              "name": "Start",
              "description": null,
              "arguments": {
                "step_variables": {
                  "input": {
                    "params": {
                      "queryURL": "{{ vars.queryURL }}",
                      "timezone": "{{ vars.timezone }}",
                      "queryBody": "{{ vars.queryBody }}",
                      "queryToRun": "{{ vars.queryToRun }}",
                      "fileToUpdate": "{{ vars.fileToUpdate }}",
                      "selectFields": "{{ vars.selectFields }}",
                      "datetimeFieldsToConvert": "{{ vars.datetimeFieldsToConvert }}"
                    }
                  }
                }
              },
              "status": null,
              "top": "30",
              "left": "125",
              "stepType": "/api/3/workflow_step_types/b348f017-9a94-471f-87f8-ce88b6a7ad62",
              "uuid": "bd320f7b-58f9-407b-844e-59420c58dc3f"
            }
          ],
          "routes": [
            {
              "@type": "WorkflowRoute",
              "name": "Run Query -> Append to CSV File",
              "targetStep": "/api/3/workflow_steps/725387d7-8917-4ce6-b2a7-5d8884655aac",
              "sourceStep": "/api/3/workflow_steps/6244a24c-db42-4e1e-8d0a-ac349750f161",
              "label": null,
              "isExecuted": false,
              "uuid": "1dc914da-557a-4391-b141-73f2e4651891"
            },
            {
              "@type": "WorkflowRoute",
              "name": "Start -> Run Query",
              "targetStep": "/api/3/workflow_steps/6244a24c-db42-4e1e-8d0a-ac349750f161",
              "sourceStep": "/api/3/workflow_steps/bd320f7b-58f9-407b-844e-59420c58dc3f",
              "label": null,
              "isExecuted": false,
              "uuid": "9e60e92c-548f-4b17-893f-58bee89e6cdd"
            }
          ],
          "priority": null,
          "uuid": "915f6b29-f9dd-4753-80dd-4d9a79d06ef4",
          "id": 88,
          "createUser": "/api/3/people/3451141c-bac6-467c-8d72-85e0fab569ce",
          "createDate": 1649320375.518916,
          "modifyUser": "/api/3/people/3451141c-bac6-467c-8d72-85e0fab569ce",
          "modifyDate": 1649320375.518916,
          "owners": [],
          "isPrivate": false,
          "deletedAt": null,
          "importedBy": [
            {
              "apiName": "sOARFramework",
              "name": "SOAR Framework",
              "version": "1.0.0"
            }
          ],
          "recordTags": [
            "Subroutine",
            "Export as CSV"
          ]
        }
      ]
    }
  ],
  "exported_tags": [
    "Subroutine",
    "Export as CSV"
  ]
}